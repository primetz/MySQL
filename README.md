![MySQL](media/logo_mysql.png)
# Нормализация БД

Процесс проектирования БД с использование метода НФ является итерационным и заключается в последовательном переводе отношения из 1НФ в НФ более высокого порядка по определенным правилам. Каждая следующая НФ ограничивается определенным типом функциональных зависимостей и устранением соответствующих аномалий при выполнении операций над отношениями БД, а также сохранении свойств предшествующих НФ.

## Первая нормальная форма (1НФ)

> Переменная отношения находится в первой нормальной форме, когда в любом допустимом значении отношения каждый его кортеж содержит только одно значение для каждого из атрибутов.

### Пример приведения к первой нормальной форме

| Категория              | Товары                    |
| :---                   | :---                      |
| Строительные материалы | Кирпич, цемент, гвозди    |
| Отделочные материалы   | Гипсокартон, обои, краска |

В ячейке "Товары" данные присутствуют не в атомарном виде, приведем данные к первой нормальной форме.

| Категория              | Товары      |
| :---                   | :---        |
| Строительные материалы | Кирпич      |
| Строительные материалы | Цемент      |
| Строительные материалы | Гвозди      |
| Отделочные материалы   | Гипсокартон |
| Отделочные материалы   | Обои        |
| Отделочные материалы   | Краска      |

## Вторая нормальная форма (2НФ)

> Переменная отношения находится во второй нормальной форме, когда она находится в первой нормальной форме, и каждый не ключевой атрибут неприводимо (функционально полно) зависит от её потенциального ключа.

### Пример приведения ко второй нормальной форме

| Категория              | Дата акции | Скидка | Товары      |
| :---                   | :---       | :---   | :---        |
| Строительные материалы | 21.06.2016 | 10%    | Кирпич      |
| Строительные материалы | 21.06.2016 | 10%    | Цемент      |
| Строительные материалы | 21.06.2016 | 10%    | Гвозди      |
| Отделочные материалы   | 25.06.2016 | 20%    | Гипсокартон |
| Отделочные материалы   | 25.06.2016 | 20%    | Обои        |
| Отделочные материалы   | 25.06.2016 | 20%    | Краска      |

В этой таблице первичные ключи представлены в виде двух столбцов – категория и дата акции. Схема функционально зависит от категории и не зависит от даты – т. е. зависимость от первичного ключа проявляется частично. Приведем таблицу ко второй нормальной форме.

| Категория              | Дата акции | Скидка |
| :---                   | :---       | :---   |
| Строительные материалы | 21.06.2016 | 10%    |
| Отделочные материалы   | 25.06.2016 | 20%    |

| Категория              | Товары      |
| :---                   | :---        |
| Строительные материалы | Кирпич      |
| Строительные материалы | Цемент      |
| Строительные материалы | Гвозди      |
| Отделочные материалы   | Гипсокартон |
| Отделочные материалы   | Обои        |
| Отделочные материалы   | Краска      |

## Третья нормальная форма (3НФ)

> Переменная отношения находится в третьей нормальной форме тогда и только тогда, когда она находится во второй нормальной форме, и отсутствуют транзитивные функциональные зависимости не ключевых атрибутов от ключевых.

### Пример приведения к третьей нормальной форме

Привести к третьей нормальной форме – это значит выделить из таблицы первичный ключ, который будет уникально идентифицировать запись в таблице.

| ID   | Категория              | 
| :--- | :---                   |
| 1    | Строительные материалы |
| 2    | Отделочные материалы   |

| Категория | Дата акции | Скидка |
| :---      | :---       | :---   |
| 1         | 21.06.2016 | 10%    |
| 2         | 25.06.2016 | 20%    |

| Категория | Товары      |
| :---      | :---        |
| 1         | Кирпич      |
| 1         | Цемент      |
| 1         | Гвозди      |
| 2         | Гипсокартон |
| 2         | Обои        |
| 2         | Краска      |


Визуализация отношений БД находящейся в 3НФ
![Визуализация отношений БД находящейся в 3НФ](media/db_relations.png)

## Нормальная форма Бойса-Кодда

> Переменная отношения находится в нормальной форме Бойса-Кодда (иначе – в усиленной третьей нормальной форме), когда каждая её нетривиальная и неприводимая слева функциональная зависимость имеет в качестве своего детерминанта некоторый потенциальный ключ.
> 
> Другими словами, в таблице должен быть только один первичный ключ.

## Четвёртая нормальная форма (4НФ)

> Переменная отношения находится в четвертой нормальной форме, если она находится в нормальной форме Бойса-Кодда и не содержит нетривиальных многозначных зависимостей.
> 
> Предположим, что рестораны производят разные виды пиццы, а службы доставки ресторанов работают только в определенных районах города. Составной первичный ключ соответствующей переменной отношения включает три атрибута:
> 
> { Ресторан, Вид пиццы, Район доставки }.
> 
>Такая переменная отношения не соответствует 4НФ, так как существует следующая многозначная зависимость:
> 
> { Ресторан } → { Вид пиццы }
> 
> { Ресторан } → { Район доставки }
> 
> То есть, например, при добавлении нового вида пиццы придется внести по одному новому кортежу для каждого района доставки. Возможна логическая аномалия, при которой определенному виду пиццы будут соответствовать лишь некоторые районы доставки из обслуживаемых рестораном районов.
> 
> Для предотвращения аномалии нужно декомпозировать отношение, разместив независимые факты в разных отношениях. В данном примере следует выполнить декомпозицию на
> 
> { Ресторан, Вид пиццы } и { Ресторан, Район доставки }.
> 
> Однако, если к исходной переменной отношения добавить атрибут, функционально зависящий от потенциального ключа, например, цену с учётом стоимости доставки ({ Ресторан, Вид пиццы, Район доставки } → Цена), полученное отношение будет находиться в 4НФ и его уже нельзя подвергнуть декомпозиции без потерь.

## Пятая нормальная форма (5НФ)

> Переменная отношения находится в пятой нормальной форме (иначе – в проекционно-соединительной нормальной форме), когда каждая нетривиальная зависимость соединения в ней определяется потенциальным ключом (ключами) этого отношения.
> 
> Другими словами, если есть сложная связь между зависимыми атрибутами, она должна выноситься в отдельную таблицу. Не нужно делать зависимость трех и более атрибутов. На практике такое встречается очень редко, но придерживаться данного правила необходимо.

## Доменно-ключевая нормальная форма

> Переменная отношения находится в ДКНФ, когда каждое наложенное на неё ограничение является логическим следствием ограничений доменов и ограничений ключей, наложенных на данную переменную отношения.

## Шестая нормальная форма (6НФ)

> Переменная отношения находится в шестой нормальной форме, когда она удовлетворяет всем нетривиальным зависимостям соединения.
> 
> Из определения следует, что переменная находится в 6НФ, когда она неприводима, то есть не может быть подвергнута дальнейшей декомпозиции без потерь. Каждая переменная отношения, которая находится в 6НФ, также находится и в 5НФ.

### Из всех представленных форм практическое применение обычно имеют первые четыре НФ.